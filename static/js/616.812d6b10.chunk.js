"use strict";(self.webpackChunkimonitor=self.webpackChunkimonitor||[]).push([[616],{92616:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var r=n(74165),s=n(15861),a=n(29439),i=n(72791),o=n(43621),c=n(72426),l=n.n(c),u=n(67945),d=n.n(u),m=(n(24655),n(68014)),f=n(75985),x=n(51921),h=n(30097),p=n.n(h),b=n(56355),v=n(63524),g=n(80184),j=function(e){var t=e.setImage,n=e.Run,o=i.useRef(null),c=(0,i.useState)(null),l=(0,a.Z)(c,2),u=l[0],d=l[1],m=(0,i.useState)(null),f=(0,a.Z)(m,2),x=f[0],h=f[1],j=(0,i.useState)(!0),w=(0,a.Z)(j,2),N=w[0],Z=w[1],y=i.useCallback((function(){var e=o.current.getScreenshot();t(e),d(e)}),[o,d]);var k=(0,i.useState)("user"),C=(0,a.Z)(k,2),T=C[0],S=C[1];(0,i.useEffect)((function(){A()}),[]);var A=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0});case 3:e.sent.getTracks().forEach((function(e){return e.stop()})),h(!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),h(!1);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0});case 3:e.sent.getTracks().forEach((function(e){return e.stop()})),h(!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),h(!1);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();return(0,g.jsx)("div",{className:"h-[380px]",children:!0===x?(0,g.jsx)("div",{className:"",children:u?(0,g.jsxs)("div",{className:"grid justify-center",children:[(0,g.jsx)("img",{src:u,alt:"Captured selfie",className:"max-h-[300px] rounded-md shadow-md shadow-black"}),(0,g.jsxs)("button",{onClick:function(){return t(!1),void d(!1)},className:"flex text-center justify-center  items-center gap-1 w-full bg-blue-950 text-white mt-3 p-1 rounded-md ",children:[(0,g.jsx)(b.Dmm,{className:"text-[20px]"}),"Re-Capture"]}),(0,g.jsx)("button",{onClick:function(){return n()},className:"flex text-center justify-center  items-center gap-1 w-full bg-blue-700 text-white mt-1 mb-3 p-1 rounded-md",children:"UPLOAD"})]}):(0,g.jsxs)("div",{className:"flex flex-col items-center h-[300px]",children:[(0,g.jsx)(p(),{audio:!1,ref:o,screenshotFormat:"image/jpeg",mirrored:N,videoConstraints:{facingMode:T},className:"max-h-[300px] rounded-md shadow-md shadow-black "}),(0,g.jsxs)("div",{className:"flex gap-5 items-center h-fit w-fit mt-3 mb-3",children:[(0,g.jsx)("button",{onClick:y,className:" rounded-full h-[50px] w-[50px] flex text-center justify-center  items-center gap-1 \r bg-blue-950 text-white mt-2 p-1 border-4 border-slate-400 shadow-sm shadow-black",children:(0,g.jsx)(b.Dmm,{className:"text-[20px]"})}),window.screen.width>768?"":(0,g.jsx)("button",{onClick:function(){Z(!N),S((function(e){return"user"===e?"environment":"user"}))},className:" rounded-full h-[50px] w-[50px] flex text-center justify-center  items-center gap-1 \r bg-blue-800 text-white mt-2 p-1 ",children:(0,g.jsx)(v.CcP,{className:"text-[20px]"})})]})]})}):(0,g.jsxs)(g.Fragment,{children:[!1===x&&(0,g.jsxs)("div",{className:"grid gap-1 justify-center",children:[(0,g.jsx)("p",{children:"Please Allow the Camera Permission to Time In."}),(0,g.jsx)("button",{onClick:I,children:"Click to Allow Camera Permission"})]}),null===x&&(0,g.jsx)("p",{children:"Checking camera permission..."})]})})},w=function(e){var t,n=e.visible,c=e.attendanceinfo,u=e.onClose,d=(e.uuid,e.setIn),m=e.companyTime,h=(0,i.useState)([]),p=(0,a.Z)(h,2),b=(p[0],p[1]),v=(0,i.useState)(!1),w=(0,a.Z)(v,2),N=w[0],Z=w[1],y=(0,i.useState)(),k=(0,a.Z)(y,2),C=k[0],T=k[1],S=(0,i.useState)(!1),A=(0,a.Z)(S,2),I=(A[0],A[1],(0,i.useState)()),O=(0,a.Z)(I,2),D=(O[0],O[1],function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==C){e.next=4;break}f.Am.warn("No Image Detected",{position:"top-right",autoClose:1e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),e.next=13;break;case 4:return Z(!0),document.getElementById("xButton").hidden=!0,C.split(",")[1],t=E(C,"selfie.jpg"),e.next=10,o.Z.storage.from("StudentUploadedImages").upload(c.studemail+"/"+"user_selfies_".concat(Date.now(),".jpg"),t,{cacheControl:"3600",contentType:"image/jpeg"});case 10:n=e.sent,n.data,B();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),E=function(e,t){var n=e.split(",");if(n.length<2)throw new Error("Invalid base64 string format");for(var r=n[0].match(/:(.*?);/)[1],s=atob(n[1]),a=s.length,i=new Uint8Array(a);a--;)i[a]=s.charCodeAt(a);return new File([i],t,{type:r})};function B(){var e=l()(),n=3600*e.hours()+60*e.minutes();t=n,U()}var H=l()().format("hh:mm:ss A"),U=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var n,s,a,i,x;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=l()(m.startingtime,"hh:mm:ss A"),a=l()(H,"hh:mm:ss A"),n=s.isAfter(a)?"ON TIME":"LATE",e.next=5,o.Z.from("AttendanceTable").update({studin:t,status:n}).eq("id",c.id);case 5:i=e.sent,x=i.data,i.error,x&&Z(!1),f.Am.success("Successfully Uploaded",{position:"top-right",autoClose:1e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),d(!0),setTimeout((function(){Z(!1),document.getElementById("xButton").hidden=!1,u(),T()}),900);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return n?(0,g.jsxs)("div",{className:"fixed h-screen inset-0 bg-black bg-opacity-30 backdrop-blur-sm flex justify-center items-center z-50",children:[(0,g.jsxs)("div",{className:"bg-[#dddede]  md:w-[30%] w-[99%] rounded-xl flex flex-col ","data-aos":"zoom-in","data-aos-duration":"300",children:[(0,g.jsx)("button",{id:"xButton",onClick:function(){return u(),b(null),void T(!1)},className:"bg-red-600 w-14 rounded-tl-md",children:"X"}),(0,g.jsx)("div",{className:" items-center grid  ",children:N?(0,g.jsxs)("div",{className:" justify-center flex-col flex items-center p-4",children:[(0,g.jsxs)("div",{className:"font-semibold text-blue-500 flex",children:["Image is uploading please wait"," "]}),(0,g.jsx)(x.Z,{color:"#4d9eff",size:10})]}):(0,g.jsxs)("div",{className:"mb-10",children:[(0,g.jsx)("p",{className:"font-semibold text-lg mb-4 text-center",children:"Upload your image here to time in"}),(0,g.jsx)(j,{setImage:T,Run:D})]})})]}),(0,g.jsx)(f.Ix,{position:"top-right",autoClose:5e3,limit:1,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"})]}):null},N=n(48273),Z=function(e){var t=e.TimeOutConfirmation,n=e.setTimeOutConfirmation,r=e.timeout,s=(0,i.useState)(!1),o=(0,a.Z)(s,2),c=o[0],l=o[1];return t?(0,g.jsxs)("div",{className:"fixed inset-0 h-screen w-screen justify-center items-center flex backdrop-blur-[1px]",children:[(0,g.jsxs)("div",{className:"h-[200px] w-[400px] bg-slate-300 rounded-md shadow-md shadow-black flex flex-col  items-center justify-center",children:[(0,g.jsx)("label",{className:"mb-3 font-semibold",children:"Are you sure you want to time out?"}),c?(0,g.jsx)("div",{className:"",children:(0,g.jsx)(N.BR,{visible:!0,height:"80",width:"80",color:"#4fa94d",ariaLabel:"puff-loading",wrapperStyle:{},wrapperClass:""})}):(0,g.jsxs)("div",{className:"gap-2 flex",children:[(0,g.jsx)("button",{onClick:function(){return n(!t)},className:"TOConfirmButton bg-red-500",children:"Cancel"}),(0,g.jsx)("button",{onClick:function(){return l(!0),void(r()&&(f.Am.success("Succesfully TimeOut",{position:"top-right",autoClose:1200,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),n(!t),l(!1)))},className:"TOConfirmButton bg-green-500",children:"Confirm"})]})]}),(0,g.jsx)(f.Ix,{})]}):null},y=function(e){var t,n=e.attendanceinfo,c=e.companyinfo,u=e.studinfo,d=e.index,m=(0,i.useState)(!1),f=(0,a.Z)(m,2),x=f[0],h=f[1],p=(0,i.useState)(!0),b=(0,a.Z)(p,2),v=b[0],j=b[1],N=(0,i.useState)(!0),y=(0,a.Z)(N,2),k=y[0],C=y[1],T=(0,i.useState)(),S=(0,a.Z)(T,2),A=S[0],I=S[1],O=l()().format("l"),D=l()().format("hh:mm A"),E=(0,i.useState)(),B=(0,a.Z)(E,2),H=B[0],U=B[1],M=(0,i.useState)(!1),R=(0,a.Z)(M,2),P=R[0],q=R[1];function F(){for(var e=l()(n.studDate).format("l"),t=0;t<c.length;t++)if(u.companyname===c[t].companyname){I({startingtime:c[t].startingtime,endingtime:c[t].endingtime});var r=V(c[t].startingtime);return e===O?null===n.studin?D>r&&j(!1):null===n.studout&&null!==n.studin&&C(!1):void 0}U(Math.ceil(99999999*Math.random()))}(0,i.useEffect)((function(){F();var e=setInterval(F(),6e4);return function(){return clearInterval(e)}}),[n]);var L=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t){var s,a,i,c,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.Z.from("StudentInformation").select().eq("studemail",n.studemail).single();case 2:if(s=e.sent,a=s.data,s.error,!a){e.next=15;break}return i=a.studprogress,c=i+t,e.next=10,o.Z.from("StudentInformation").update({studprogress:c}).eq("studemail",n.studemail);case 10:if(l=e.sent,l.data1,l.error,!z()){e.next=15;break}return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.Z.from("AttendanceTable").update({studout:t}).eq("id",n.id);case 2:return s=e.sent,s.data,s.error,C(!0),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();var J,Y,_=function(e,t){var r=Math.floor((t-e)/3600);return null!==e&&null!==t&&O===l()(n.studDate).format("l")?r:0},V=function(e){return l()(e,"HH:mm").subtract(1,"hours").format("hh:mm A")};return(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{className:"".concat(0===d?"p-2 duration-300 shadow-black shadow-md bg-white mb-4 ":"bg-gray-400  mb-0.5","  rounded-md flex p-1 justify-between z-0"),children:[(0,g.jsx)("p",{className:"text-left m-2 pl-2 font-semibold text-[17px]",children:n.studDate+""}),(0,g.jsx)("div",{className:"",children:O===l()(n.studDate).format("l")?(0,g.jsx)(g.Fragment,{children:(J=n.studin,Y=n.studout,null===J||null===Y?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("button",{disabled:v,onClick:function(){return h(!0)},className:"".concat(v?"h-10 w-24 rounded-md  bg-gray-600 text-center mr-2 hover:cursor-not-allowed":"h-10 w-24 rounded-md hover:bg-green-400 bg-green-600 text-center mr-2 hover:cursor-pointer"),children:"TIME IN"}),(0,g.jsx)("button",{disabled:k,onClick:function(){return q(!P)},className:"".concat(k?"h-10 w-24 rounded-md  bg-gray-600 text-center mr-2 hover:cursor-not-allowed":"h-10 w-24 rounded-md hover:bg-red-400 bg-red-600 text-center mr-2 hover:cursor-pointer"),children:"TIME OUT"})," "]}):(0,g.jsx)("div",{className:"flex items-center h-full ",children:(0,g.jsxs)("div",{className:"items-center flex h-full mr-5 font-thin gap-1",children:["Total hours rendered:",(0,g.jsx)("div",{className:"font-bold ",children:_(n.studin,n.studout)})]})}))}):(0,g.jsxs)("div",{className:"items-center flex h-full mr-5 font-thin gap-1",children:["Total hours rendered:",(0,g.jsx)("div",{className:"font-thin",children:_(n.studin,n.studout)})]})})]}),(0,g.jsx)(w,{attendanceinfo:n,onClose:function(){return h(!1)},visible:x,uuid:H,setIn:j,companyTime:A}),(0,g.jsx)(Z,{TimeOutConfirmation:P,setTimeOutConfirmation:q,timeout:function(){var e=l()(),r=3600*e.hours()+60*e.minutes();if(t=r,function(){if(null!==n.studin&&null!==t){var e=t-n.studin,r=Math.floor(e/3600);if(r>9&&(r=8),L(r))return!0}}())return!0}})," "]})},k=function(e){var t=e.studemail,n=(0,i.useState)(!1),c=(0,a.Z)(n,2),u=c[0],f=c[1],x=(0,i.useState)(!1),h=(0,a.Z)(x,2),p=h[0],b=h[1],v=(0,i.useState)([]),j=(0,a.Z)(v,2),w=j[0],Z=j[1],k=(0,i.useState)(""),C=(0,a.Z)(k,2),T=C[0],S=C[1],A=(0,i.useState)(""),I=(0,a.Z)(A,2),O=I[0],D=I[1],E=l()(new Date).format("l"),B=(0,i.useState)(),H=(0,a.Z)(B,2),U=H[0],M=H[1],R=(0,i.useState)(),P=(0,a.Z)(R,2),q=P[0],F=P[1],L=(0,i.useState)(),z=(0,a.Z)(L,2),J=z[0],Y=z[1];(0,i.useEffect)((function(){d().init({duration:1e3}),_(),o.Z.channel("custom-all-channel").on("postgres_changes",{event:"UPDATE",schema:"public",table:"AttendanceTable"},(function(e){_()})).on("postgres_changes",{event:"INSERT",schema:"public",table:"AttendanceTable"},(function(e){_()})).subscribe()}),[t]);var _=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var n,s,a,i,c,u,d,m;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.Z.from("StudentInformation").select().eq("studemail",t).single();case 2:n=e.sent,(s=n.data)&&(F(s),S(s.studprogress),D(s.studmaxprogress),a=l()(s.ojtend).format("L"),i=l()(s.ojtstart).format("L"),c=l()(),u=c.isSameOrAfter(i),d=c.isAfter(a),m=c.isBefore(i),u&&(Q(),!0),d&&(f(!0),!1,console.log("2")),m&&(console.log("3"),b(!0)),V());case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function V(){return X.apply(this,arguments)}function X(){return(X=(0,s.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.Z.from("CompanyTable").select();case 2:t=e.sent,n=t.data,t.error,M(n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var G,K=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.Z.from("AttendanceTable").insert({studemail:t,studDate:E,course:null===n||void 0===n?void 0:n.studcourse,studname:null===n||void 0===n?void 0:n.studname});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var n,s,a,i,c,u,d,m,f;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.Z.from("AttendanceTable").select().eq("studemail",t);case 3:return n=e.sent,s=n.data,n.error,e.next=8,o.Z.from("StudentInformation").select().eq("studemail",t).single();case 8:return a=e.sent,i=a.data,e.next=12,o.Z.from("CompanyTable").select().eq("companyname",i.companyname).single();case 12:return c=e.sent,u=c.data,e.t0=Y,e.next=17,u;case 17:return e.t1=e.sent,(0,e.t0)(e.t1),e.t2=Z,e.next=22,s;case 22:if(e.t3=e.sent,(0,e.t2)(e.t3),0!==s.length){e.next=28;break}K(i),e.next=40;break;case 28:d=!1,m=0;case 30:if(!(m<s.length)){e.next=39;break}if(f=l()(s[m].studDate).format("l"),E!==f){e.next=36;break}return Z(s),d=!0,e.abrupt("break",39);case 36:m++,e.next=30;break;case 39:d||K(i);case 40:e.next=44;break;case 42:e.prev=42,e.t4=e.catch(0);case 44:case"end":return e.stop()}}),e,null,[[0,42]])})));return function(){return e.apply(this,arguments)}}(),W=function(e){return l()(e,"HH:mm").format("hh:mm A")};return(0,g.jsx)("div",{className:" ",children:w&&U?(0,g.jsx)("div",{className:"flex md:w-[100%] w-full justify-center",children:(0,g.jsxs)("div",{className:"mt-[5%]","data-aos":"fade-down","data-aos-duration":"1000",children:[(0,g.jsx)("div",{onClick:function(){},className:"font-bold text-white text-4xl flex ml-[5%] md:mt-1 mt-5 mb-5",children:"ATTENDANCE"}),(0,g.jsx)("div",{className:" w-fit ml-5 mr-5 shadow-md shadow-black",children:(0,g.jsxs)("div",{className:"md:w-[500px] w-full h-[450px] rounded-t-md bg-slate-200 rounded-b-md",children:[(0,g.jsx)("div",{className:"w-full bg-[#274472] rounded-t-md p-2 flex-col md:gap-10 gap-1",children:(0,g.jsxs)("div",{className:"mt-3 mb-3 flex text-white",children:[(0,g.jsxs)("div",{className:"md:text-[15px] text-[10px] text-center font-semibold  mr-2",children:["OJT DURATION:",(0,g.jsxs)("div",{className:" whitespace-nowrap z-0 md:text-[15px] text-[10px] font-mono font-light mr-3 ",children:[T," / ",O]})]}),(0,g.jsx)("div",{className:" w-[70%] bg-gray-100 rounded-sm  md:h-10 h-7 ",children:(0,g.jsx)("div",{className:" md:h-10 h-7 w-[1%] bg-[#78D0F4] rounded-sm  ",style:{width:"".concat(T/O*100,"%")}})})]})}),u&&(0,g.jsxs)("div",{className:"",children:[(0,g.jsx)("div",{className:"font-bold text-[25px] text-center mt-[22%]",children:"YOUR OJT IS FINISHED"}),(0,g.jsx)(m.o7R,{className:"text-8xl ml-[40%] text-center"})]}),p&&(0,g.jsxs)("div",{className:"justify-center flex flex-col",children:[(0,g.jsx)("div",{className:"font-bold text-[25px] justify-center text-center mt-[20%]",children:"YOUR OJT HAVEN'T STARTED YET"}),(0,g.jsx)("div",{"data-tip":"Your Attendance will be shown when the OJT starts",className:"hover:text-blue-600 hover:cursor-help text-blue-900 font-semibold underline justify-center text-center before:text-sm before:content-[attr(data-tip)] before:absolute before:px-3 before: py-2 before:left/1 before: top-3 before:w-max before:max-w-xs before:-translate-x-1/3 before:-translate-y-full before:bg-gray-200 before:text-black before:border-black before:border-2 before:rounded-md before:opacity-0 before:transition-all hover:before:opacity-100",children:"Learn More"})]}),!0===p||!0===u?"":(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{className:"flex justify-center items-center font-thin text-[12px]",children:[(0,g.jsxs)("div",{className:"bg-green-100 w-full p-1 justify-center flex gap-1",children:["Time in starts",(0,g.jsxs)("em",{className:"font-normal",children:[(G=null===J||void 0===J?void 0:J.startingtime,l()(G,"HH:mm").subtract(1,"hours").format("hh:mm A"))," ","- ",W(null===J||void 0===J?void 0:J.startingtime)]})," ","only"]}),(0,g.jsxs)("div",{className:"bg-red-100 w-full p-1 justify-center flex gap-1",children:["Time out ends",(0,g.jsx)("em",{className:"font-normal",children:W(null===J||void 0===J?void 0:J.endingtime)})]})]}),U&&(0,g.jsx)("div",{className:"p-2 h-[335px] rounded-md overflow-y-auto",children:w.sort((function(e,t){return e.studDate<t.studDate?1:-1})).map((function(e,t){return(0,g.jsx)(y,{attendanceinfo:e,studinfo:q,companyinfo:U,index:t},e.id)}))})]})]})})]})}):(0,g.jsx)("div",{className:"flex flex-col items-center justify-center h-[90%]",children:(0,g.jsx)(N.gy,{height:"80",width:"80",color:"#0074B7",ariaLabel:"tail-spin-loading",radius:"0",wrapperStyle:{},wrapperClass:"",visible:!0})})})}}}]);
//# sourceMappingURL=616.812d6b10.chunk.js.map