"use strict";(self.webpackChunkimonitor=self.webpackChunkimonitor||[]).push([[90],{83090:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var r=n(93433),s=n(74165),a=n(15861),i=n(29439),o=n(72791),c=n(43621),l=n(72426),u=n.n(l),d=n(67945),m=n.n(d),f=(n(24655),n(68014)),x=n(75985),h=n(51921),p=n(30097),v=n.n(p),b=n(56355),g=n(63524),j=n(80184),w=function(e){var t=e.setImage,n=e.Run,r=o.useRef(null),c=(0,o.useState)(null),l=(0,i.Z)(c,2),u=l[0],d=l[1],m=(0,o.useState)(null),f=(0,i.Z)(m,2),x=f[0],h=f[1],p=(0,o.useState)(!0),w=(0,i.Z)(p,2),Z=w[0],N=w[1],y=o.useCallback((function(){var e=r.current.getScreenshot();t(e),d(e)}),[r,d]);var k=(0,o.useState)("user"),S=(0,i.Z)(k,2),T=S[0],M=S[1];(0,o.useEffect)((function(){C()}),[]);var C=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0});case 3:e.sent.getTracks().forEach((function(e){return e.stop()})),h(!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),h(!1);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0});case 3:e.sent.getTracks().forEach((function(e){return e.stop()})),h(!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),h(!1);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();return(0,j.jsx)("div",{className:"h-[380px]",children:!0===x?(0,j.jsx)("div",{className:"",children:u?(0,j.jsxs)("div",{className:"grid justify-center",children:[(0,j.jsx)("img",{src:u,alt:"Captured selfie",className:"max-h-[300px] rounded-md shadow-md shadow-black"}),(0,j.jsxs)("button",{onClick:function(){return t(!1),void d(!1)},className:"flex text-center justify-center  items-center gap-1 w-full bg-blue-950 text-white mt-3 p-1 rounded-md ",children:[(0,j.jsx)(b.Dmm,{className:"text-[20px]"}),"Re-Capture"]}),(0,j.jsx)("button",{onClick:function(){return n()},className:"flex text-center justify-center  items-center gap-1 w-full bg-blue-700 text-white mt-1 mb-3 p-1 rounded-md",children:"UPLOAD"})]}):(0,j.jsxs)("div",{className:"flex flex-col items-center h-[300px]",children:[(0,j.jsx)(v(),{audio:!1,ref:r,screenshotFormat:"image/jpeg",mirrored:Z,videoConstraints:{facingMode:T},className:"max-h-[300px] rounded-md shadow-md shadow-black "}),(0,j.jsxs)("div",{className:"flex gap-5 items-center h-fit w-fit mt-3 mb-3",children:[(0,j.jsx)("button",{onClick:y,className:" rounded-full h-[50px] w-[50px] flex text-center justify-center  items-center gap-1 \r bg-blue-950 text-white mt-2 p-1 border-4 border-slate-400 shadow-sm shadow-black",children:(0,j.jsx)(b.Dmm,{className:"text-[20px]"})}),window.screen.width>768?"":(0,j.jsx)("button",{onClick:function(){N(!Z),M((function(e){return"user"===e?"environment":"user"}))},className:" rounded-full h-[50px] w-[50px] flex text-center justify-center  items-center gap-1 \r bg-blue-800 text-white mt-2 p-1 ",children:(0,j.jsx)(g.CcP,{className:"text-[20px]"})})]})]})}):(0,j.jsxs)(j.Fragment,{children:[!1===x&&(0,j.jsxs)("div",{className:"grid gap-1 justify-center",children:[(0,j.jsx)("p",{children:"Please Allow the Camera Permission to Time In."}),(0,j.jsx)("button",{onClick:D,children:"Click to Allow Camera Permission"})]}),null===x&&(0,j.jsx)("p",{children:"Checking camera permission..."})]})})},Z=function(e){var t,n=e.visible,r=e.attendanceinfo,l=e.onClose,d=(e.uuid,e.setIn),m=e.companyTime,f=(0,o.useState)([]),p=(0,i.Z)(f,2),v=(p[0],p[1]),b=(0,o.useState)(!1),g=(0,i.Z)(b,2),Z=g[0],N=g[1],y=(0,o.useState)(),k=(0,i.Z)(y,2),S=k[0],T=k[1],M=(0,o.useState)(!1),C=(0,i.Z)(M,2),D=(C[0],C[1],(0,o.useState)()),A=(0,i.Z)(D,2),Y=(A[0],A[1],function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==S){e.next=4;break}x.Am.warn("No Image Detected",{position:"top-right",autoClose:1e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),e.next=13;break;case 4:return N(!0),document.getElementById("xButton").hidden=!0,S.split(",")[1],t=I(S,"selfie.jpg"),e.next=10,c.Z.storage.from("StudentUploadedImages").upload(r.studemail+"/"+"user_selfies_".concat(Date.now(),".jpg"),t,{cacheControl:"3600",contentType:"image/jpeg"});case 10:n=e.sent,n.data,O();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),I=function(e,t){var n=e.split(",");if(n.length<2)throw new Error("Invalid base64 string format");for(var r=n[0].match(/:(.*?);/)[1],s=atob(n[1]),a=s.length,i=new Uint8Array(a);a--;)i[a]=s.charCodeAt(a);return new File([i],t,{type:r})};function O(){var e=u()(),n=3600*e.hours()+60*e.minutes();t=n,B()}var E=u()(),B=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var n,a,i,o,f;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u()(m.startimgtime,"HH:mm:ss"),a=n.clone().subtract(1,"hours"),i=n.isSameOrAfter(a)&&E.isBefore(n)?"ON TIME":"LATE",e.next=5,c.Z.from("AttendanceTable").update({studin:t,status:i}).eq("id",r.id);case 5:o=e.sent,f=o.data,o.error,f&&N(!1),x.Am.success("Successfully Uploaded",{position:"top-right",autoClose:1e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),d(!0),setTimeout((function(){N(!1),document.getElementById("xButton").hidden=!1,l(),T()}),900);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return n?(0,j.jsxs)("div",{className:"fixed h-screen inset-0 bg-black bg-opacity-30 backdrop-blur-sm flex justify-center items-center z-50",children:[(0,j.jsxs)("div",{className:"bg-[#dddede]  md:w-[30%] w-[99%] rounded-xl flex flex-col ","data-aos":"zoom-in","data-aos-duration":"300",children:[(0,j.jsx)("button",{id:"xButton",onClick:function(){return l(),v(null),void T(!1)},className:"bg-red-600 w-14 rounded-tl-md",children:"X"}),(0,j.jsx)("div",{className:" items-center grid  ",children:Z?(0,j.jsxs)("div",{className:" justify-center flex-col flex items-center p-4",children:[(0,j.jsxs)("div",{className:"font-semibold text-blue-500 flex",children:["Image is uploading please wait"," "]}),(0,j.jsx)(h.Z,{color:"#4d9eff",size:10})]}):(0,j.jsxs)("div",{className:"mb-10",children:[(0,j.jsx)("p",{className:"font-semibold text-lg mb-4 text-center",children:"Upload your image here to time in"}),(0,j.jsx)(w,{setImage:T,Run:Y})]})})]}),(0,j.jsx)(x.Ix,{position:"top-right",autoClose:5e3,limit:1,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"})]}):null},N=function(e){var t,n=e.attendanceinfo,r=e.companyinfo,l=e.studinfo,d=e.index,m=(0,o.useState)(!1),f=(0,i.Z)(m,2),x=f[0],h=f[1],p=(0,o.useState)(!0),v=(0,i.Z)(p,2),b=v[0],g=v[1],w=(0,o.useState)(!0),N=(0,i.Z)(w,2),y=N[0],k=N[1],S=(0,o.useState)(),T=(0,i.Z)(S,2),M=T[0],C=T[1],D=u()().format("l"),A=u()(),Y=(0,o.useState)(),I=(0,i.Z)(Y,2),O=I[0],E=I[1];function B(){for(var e=u()(n.studDate).format("l"),t=0;t<r.length;t++)if(l.companyname===r[t].companyname){C({startimgtime:r[t].startingtime,endingtime:r[t].endingtime});var s=u()(r[t].endingtime,"HH:mm:ss");if(e===D)if(null===n.studin){if(A.isAfter(s))return void g(!0);g(!1)}else{if(A.isAfter(s))return void k(!1);if(null!==n.studout)return void k(!0);k(!1)}return}E(Math.ceil(99999999*Math.random()))}function H(){var e=u()(),r=3600*e.hours()+60*e.minutes();t=r,function(){if(null!==n.studin&&null!==t){var e=t-n.studin,r=Math.floor(e/3600);r>9&&(r=8),U(r)}}()}(0,o.useEffect)((function(){B();var e=setInterval(B(),6e4);return function(){return clearInterval(e)}}),[n]);var U=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,a,i,o,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.Z.from("StudentInformation").select().eq("studemail",n.studemail).single();case 2:if(r=e.sent,a=r.data,r.error,!a){e.next=14;break}return i=a.studprogress,o=i+t,e.next=10,c.Z.from("StudentInformation").update({studprogress:o}).eq("studemail",n.studemail);case 10:l=e.sent,l.data1,l.error,R();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.Z.from("AttendanceTable").update({studout:t}).eq("id",n.id);case 2:r=e.sent,r.data,r.error,k(!0);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,j.jsxs)("div",{children:[(0,j.jsxs)("div",{className:"".concat(0===d?"p-2 duration-300 shadow-black shadow-md bg-white mb-4 ":"bg-gray-400  mb-0.5","  rounded-md flex p-1 justify-between z-0"),children:[(0,j.jsx)("p",{className:"text-left m-2 pl-2 font-semibold text-[17px]",children:n.studDate+""}),(0,j.jsx)("div",{className:"",children:D===u()(n.studDate).format("l")?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("button",{disabled:b,onClick:function(){return h(!0)},className:"".concat(b?"h-10 w-24 rounded-md  bg-gray-600 text-center mr-2 hover:cursor-not-allowed":"h-10 w-24 rounded-md hover:bg-green-400 bg-green-600 text-center mr-2 hover:cursor-pointer"),children:"TIME IN"}),(0,j.jsx)("button",{disabled:y,onClick:function(){return H()},className:"".concat(y?"h-10 w-24 rounded-md  bg-gray-600 text-center mr-2 hover:cursor-not-allowed":"h-10 w-24 rounded-md hover:bg-red-400 bg-red-600 text-center mr-2 hover:cursor-pointer"),children:"TIME OUT"})]}):(0,j.jsxs)("div",{className:"items-center flex h-full mr-5 font-thin gap-1",children:["Total hours rendered:",(0,j.jsx)("div",{className:"font-thin",children:function(e,t){var n=Math.floor((t-e)/3600);return null!==e&&null!==t?n:0}(n.studin,n.studout)})]})})]}),(0,j.jsx)(Z,{attendanceinfo:n,onClose:function(){return h(!1)},visible:x,uuid:O,setIn:g,companyTime:M})]})},y=n(48273),k=function(e){var t=e.studemail,n=(0,o.useState)(!1),l=(0,i.Z)(n,2),d=l[0],x=l[1],h=(0,o.useState)(!1),p=(0,i.Z)(h,2),v=p[0],b=p[1],g=(0,o.useState)([]),w=(0,i.Z)(g,2),Z=w[0],k=w[1],S=(0,o.useState)(""),T=(0,i.Z)(S,2),M=T[0],C=T[1],D=(0,o.useState)(""),A=(0,i.Z)(D,2),Y=A[0],I=A[1],O=u()(new Date).format("l"),E=(0,o.useState)(),B=(0,i.Z)(E,2),H=B[0],U=B[1],R=(0,o.useState)(),P=(0,i.Z)(R,2),q=P[0],F=P[1],L=(0,o.useState)(),z=(0,i.Z)(L,2),J=z[0],_=z[1];(0,o.useEffect)((function(){m().init({duration:1e3}),V(),c.Z.channel("custom-all-channel").on("postgres_changes",{event:"UPDATE",schema:"public",table:"AttendanceTable"},(function(e){V()})).on("postgres_changes",{event:"INSERT",schema:"public",table:"AttendanceTable"},(function(e){V()})).subscribe()}),[t]);var V=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var n,r,a,i,o,l,d,m;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.Z.from("StudentInformation").select().eq("studemail",t).single();case 2:n=e.sent,(r=n.data)&&(F(r),C(r.studprogress),I(r.studmaxprogress),a=u()(r.ojtend).format("L"),i=u()(r.ojtstart).format("L"),o=u()(),l=o.isSameOrAfter(i),d=o.isAfter(a),m=o.isBefore(i),l&&(W(),!0),d&&(x(!0),!1,console.log("2")),m&&(console.log("3"),b(!0)),X());case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function X(){return G.apply(this,arguments)}function G(){return(G=(0,a.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.Z.from("CompanyTable").select();case 2:t=e.sent,n=t.data,t.error,U(n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K,Q=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.Z.from("AttendanceTable").insert({studemail:t,studDate:O,course:null===n||void 0===n?void 0:n.studcourse,studname:null===n||void 0===n?void 0:n.studname});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),W=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var n,r,a,i,o,l,d,m,f;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.Z.from("AttendanceTable").select().eq("studemail",t);case 3:return n=e.sent,r=n.data,n.error,e.next=8,c.Z.from("StudentInformation").select().eq("studemail",t).single();case 8:return a=e.sent,i=a.data,e.next=12,c.Z.from("CompanyTable").select().eq("companyname",i.companyname).single();case 12:return o=e.sent,l=o.data,e.t0=_,e.next=17,l;case 17:return e.t1=e.sent,(0,e.t0)(e.t1),e.t2=k,e.next=22,r;case 22:if(e.t3=e.sent,(0,e.t2)(e.t3),0!==r.length){e.next=28;break}Q(i),e.next=40;break;case 28:d=!1,m=0;case 30:if(!(m<r.length)){e.next=39;break}if(f=u()(r[m].studDate).format("l"),O!==f){e.next=36;break}return k(r),d=!0,e.abrupt("break",39);case 36:m++,e.next=30;break;case 39:d||Q(i);case 40:e.next=44;break;case 42:e.prev=42,e.t4=e.catch(0);case 44:case"end":return e.stop()}}),e,null,[[0,42]])})));return function(){return e.apply(this,arguments)}}(),$=function(e){return u()(e,"HH:mm").format("hh:mm A")};return(0,j.jsx)("div",{className:" ",children:Z&&H?(0,j.jsx)("div",{className:"flex md:w-[100%] w-full justify-center",children:(0,j.jsxs)("div",{className:"mt-[5%]","data-aos":"fade-down","data-aos-duration":"1000",children:[(0,j.jsx)("div",{onClick:function(){return function(){var e=Z.map((function(e){return u()(e.studDate)})),t=u().min.apply(u(),(0,r.Z)(e)),n=(u()(),u()().startOf("month").format("MMMM D, YYYY")),s=u()(Z.studDate).format("MMMM D, YYYY");console.log(n),console.log(t.format("MMMM D, YYYY"));var a=function(e,t){for(var n=u()(e,"MMMM D, YYYY"),r=u()(t,"MMMM D, YYYY"),s=u()().startOf("day"),a=[],i=u()(n);i.isSameOrBefore(s)&&i.isSameOrBefore(r);)a.push(i.format("MMMM D, YYYY")),i.add(1,"day");return a}(n,s);console.log(a)}()},className:"font-bold text-white text-4xl flex ml-[5%] md:mt-1 mt-5 mb-5",children:"ATTENDANCE"}),(0,j.jsx)("div",{className:" w-fit ml-5 mr-5 shadow-md shadow-black",children:(0,j.jsxs)("div",{className:"md:w-[500px] w-full h-[450px] rounded-t-md bg-slate-200 rounded-b-md",children:[(0,j.jsx)("div",{className:"w-full bg-[#274472] rounded-t-md p-2 flex-col md:gap-10 gap-1",children:(0,j.jsxs)("div",{className:"mt-3 mb-3 flex text-white",children:[(0,j.jsxs)("div",{className:"md:text-[15px] text-[10px] text-center font-semibold  mr-2",children:["OJT DURATION:",(0,j.jsxs)("div",{className:" whitespace-nowrap z-0 md:text-[15px] text-[10px] font-mono font-light mr-3 ",children:[M," / ",Y]})]}),(0,j.jsx)("div",{className:" w-[70%] bg-gray-100 rounded-sm  md:h-10 h-7 ",children:(0,j.jsx)("div",{className:" md:h-10 h-7 w-[1%] bg-[#78D0F4] rounded-sm  ",style:{width:"".concat(M/Y*100,"%")}})})]})}),d&&(0,j.jsxs)("div",{className:"",children:[(0,j.jsx)("div",{className:"font-bold text-[25px] text-center mt-[22%]",children:"YOUR OJT IS FINISHED"}),(0,j.jsx)(f.o7R,{className:"text-8xl ml-[40%] text-center"})]}),v&&(0,j.jsxs)("div",{className:"justify-center flex flex-col",children:[(0,j.jsx)("div",{className:"font-bold text-[25px] justify-center text-center mt-[20%]",children:"YOUR OJT HAVEN'T STARTED YET"}),(0,j.jsx)("div",{"data-tip":"Your Attendance will be shown when the OJT starts",className:"hover:text-blue-600 hover:cursor-help text-blue-900 font-semibold underline justify-center text-center before:text-sm before:content-[attr(data-tip)] before:absolute before:px-3 before: py-2 before:left/1 before: top-3 before:w-max before:max-w-xs before:-translate-x-1/3 before:-translate-y-full before:bg-gray-200 before:text-black before:border-black before:border-2 before:rounded-md before:opacity-0 before:transition-all hover:before:opacity-100",children:"Learn More"})]}),!0===v||!0===d?"":(0,j.jsxs)("div",{children:[(0,j.jsxs)("div",{className:"flex justify-center items-center font-thin text-[12px]",children:[(0,j.jsxs)("div",{className:"bg-green-100 w-full p-1 justify-center flex gap-1",children:["Time in starts",(0,j.jsxs)("em",{className:"font-normal",children:[(K=null===J||void 0===J?void 0:J.startingtime,u()(K,"HH:mm").subtract(1,"hours").format("hh:mm A"))," ","- ",$(null===J||void 0===J?void 0:J.startingtime)]})," ","only"]}),(0,j.jsxs)("div",{className:"bg-red-100 w-full p-1 justify-center flex gap-1",children:["Time out ends",(0,j.jsx)("em",{className:"font-normal",children:$(null===J||void 0===J?void 0:J.endingtime)})]})]}),H&&(0,j.jsx)("div",{className:"p-2 h-[335px] rounded-md overflow-y-auto",children:Z.sort((function(e,t){return e.studDate<t.studDate?1:-1})).map((function(e,t){return(0,j.jsx)(N,{attendanceinfo:e,studinfo:q,companyinfo:H,index:t},e.id)}))})]})]})})]})}):(0,j.jsx)("div",{className:"flex flex-col items-center justify-center h-[90%]",children:(0,j.jsx)(y.gy,{height:"80",width:"80",color:"#0074B7",ariaLabel:"tail-spin-loading",radius:"0",wrapperStyle:{},wrapperClass:"",visible:!0})})})}}}]);
//# sourceMappingURL=90.e819f293.chunk.js.map